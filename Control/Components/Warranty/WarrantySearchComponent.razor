@using Entities;
@using Business;





    <div class="form-group row">
        <div class="col">
            <label class="col-form-label">Serie del Equipo</label>
            <select class="rounded form-control" @bind="@DeviceIdToSearch">
                <option value="">Serie</option>
                @foreach (var it in Devices)
                {
                    <option value="@it.Key"> @it.Value - @it.Key </option>
                }
            </select>
        </div>
        <div class="col">
            <label class="col-form-label">Envio de cerfificado</label>
            <select class="form-control rounded" @bind="@YearToSearch">
                <option value="0">Seleccione un año...</option>
                @foreach (var item in Years)
                {
                    <option value="@item">@item</option>

                }
            </select>
        </div>
        <div class="col">
            <label class="col-form-label">Estado de la garantia</label>
            <select class="form-control rounded " @bind="@EstatusToSearch">
                <option value="">Seleccione un estado...</option>
                <option value="En tramite">En tramite</option>
                <option value="Recibido">Recibido</option>
                <option value="Con Problemas">Con Problemas</option>
            </select>
        </div>
    </div>
    <div class="form-group row">
        <div class="col-3">
            <input type="button" value="Buscar" class="btn btn-outline-dark rounded" @onclick="SearchWarranties" />
        </div>
        <div class="col-3">
            <input type="button" value="Limpiar" class="btn btn-outline-dark rounded" @onclick="CleanSpaces" />
        </div>
        <div class="col-3">
            <input type="button" value="Generar" class="btn btn-outline-dark rounded" />
        </div>
    </div>

    <p class="text-center" style="color:red"> @ErrorMessage</p>


    <table class=" table table-hover table-striped table-responsive-sm ">
        <thead>
            <tr>
                <th> Numero de Serie del equipo </th>
                <th> Fecha Envio España</th>
                <th> Fecha Recepción España</th>
                <th> </th>
                <th> </th>
                <th> </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var obj in Warranties)
            {
                <tr>
                    <td> @obj.DeviceId </td>
                    <td> @obj.DateSend.ToShortDateString()</td>                   
                    <td> <a href="warranty/view/@obj.Id">Ver</a></td>
                    <td> <a href="warranty/update/@obj.Id">Modificar</a></td>
                    <td> <a style="color:red" href="warranty/delete/@obj.Id">Eliminar</a></td>
                </tr>
            }
        </tbody>
    </table>


@code{
    public List<WarrantyEntity> Warranties = new List<WarrantyEntity>();
    public List<int> Years = new List<int>();
    private Dictionary<string, string> Devices;

    #region internal

    private string DeviceIdToSearch = null;
    private int YearToSearch = 0;
    private string EstatusToSearch = null;
    private string ErrorMessage = "";
    #endregion
    protected override async Task OnInitializedAsync()
    {
        Years = B_Warranty.GetYearsOfSend();
        Devices = B_Device.GetDictonaryOfDevicesWithClient();
    }
    private void CleanSpaces()
    {
        DeviceIdToSearch = null;
        YearToSearch = 0;
        EstatusToSearch = null;
    }
    private void SearchWarranties()
    {
        Warranties = B_Warranty.SearchWarranties(DeviceIdToSearch, EstatusToSearch, YearToSearch);
        if (Warranties.Count <= 0)
        {
            ErrorMessage = "No hay coincidencias con los criterios de busqueda";
        }
        else
        {
            ErrorMessage = "";
        }

    }
}
