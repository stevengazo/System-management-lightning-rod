@using Entities;
@using Business;
@inject NavigationManager Nav;

<EditForm Model="oWarranty">
    <div class="form-group">
        <label>Seleccione el Dispositivo</label>
        <InputSelect @bind-Value="oWarranty.DeviceId" class="form-control">
            <option value="0">Seleccione...</option>
            @foreach (var obj in Devices)
            {
                <option value="@obj.Key">@obj.Value  @obj.Key</option>
            }
        </InputSelect>
    </div>
    <div class="form-group">
        <label>Fecha envío Protocolo</label>
        <InputDate @bind-Value="oWarranty.DateSend" class="form-control" ></InputDate>
    </div>
    <div class="form-group">
        <label>Fecha recepción Garantía</label>
        <InputDate @bind-Value="oWarranty.DateReceived" class="form-control"></InputDate>
    </div>
    <div class="form-group">
        <label>Notas:</label>
        <InputTextArea @bind-Value="oWarranty.Notes" class="form-control"></InputTextArea>
    </div>
    <div class="form-group">
        <label>Estatus</label>
        <InputSelect @bind-Value="oWarranty.StatusId" class="form-control">
            <option value="">Seleccione un estado...</option>
            @foreach (var item in status)
            {
                <option value="@item.StatusId">@item.StatusName</option>
            }
        </InputSelect>
    </div>
</EditForm>

<input type="button" value="Guardar Registro" class="btn-info" @onclick="SaveWarranty"/>
<p>@Message</p>

@code{
    WarrantyEntity oWarranty = new WarrantyEntity();    
    Dictionary<string, string> Devices = new Dictionary<string, string>();
    List<StatusEntity> status = new List<StatusEntity>();
    string Message = "";

    protected override async Task OnInitializedAsync()
    {

        Devices = B_Device.GetDictonaryOfDevicesWithClient();
        status = B_Status.GetStatus();
    }

    private void SaveWarranty()
    {
        try
        {
            oWarranty.Id = Guid.NewGuid().ToString();

            B_Warranty.Create(oWarranty);
            Nav.NavigateTo($"warranty/view/{oWarranty.Id}");        
        }catch(Exception f)
        {
            Message = $"Error: {f.Message}. Intentelo de nuevo";
        }

    }

}