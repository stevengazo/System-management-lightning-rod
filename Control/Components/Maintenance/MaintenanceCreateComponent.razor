@using Entities;
@using Business;
@inject NavigationManager Nav;



<EditForm Model="oMaintenance">
    <div class="form-group">
        <label>Fecha de Mantenimiento</label>
        <InputDate class="form-control" @bind-Value="oMaintenance.MaintenanceDate"></InputDate>
    </div>
    <div class="form-group">
        <label> Estado del dispositivo</label>
        <InputTextArea class="form-control" @bind-Value="oMaintenance.StatusOfDevice"></InputTextArea>
    </div>
    <div class="form-group">
        <label> Resistencia de la malla</label>
        <InputNumber class="form-control" @bind-Value="oMaintenance.SpatOhms"></InputNumber>
    </div>
    <div class="form-group">
        <label>Resistencia de las Semiesferas del Dispositivo</label>
        <InputNumber class="form-control" @bind-Value="oMaintenance.DeviceOhms"></InputNumber>
    </div>
    <div class="form-group">
        <label>Transferencia de Cargas</label>
        <InputNumber class="form-control" @bind-Value="oMaintenance.Ampers"></InputNumber>
    </div>
    <div class="form-group">
        <label>Nombre del Técnico</label>
        <InputText class="form-control" @bind-Value="oMaintenance.TechnicianName"></InputText>
    </div>
    <div class="form-group">
        <label>Numero de Informe</label>
        <InputText class="form-control" @bind-Value="oMaintenance.ReportId"></InputText>
    </div>
    <div class="form-group">
        <label>Recomendaciones</label>
        <InputTextArea class="form-control" @bind-Value="oMaintenance.Recomendations"></InputTextArea>
    </div>
    <div class="form-group">
        <label>Numero de Equipo</label>
        <InputSelect class="form-control" @bind-Value="oMaintenance.DeviceId" >
            <option value="0"> Seleccione un equipo...</option>
            @foreach (var Device in Devices)
	        {       
	            <option value="@Device.DeviceId">@Device.Client.Name - @Device.DeviceId </option>	 
	        }
        </InputSelect>        
    </div>    
    <div>
        <label>¿Numero de serie no visble?</label>
        <a href="device/create"  target="_blank"> Crear dispositivo</a>
    </div>
</EditForm>




<input type="button" value="Registrar Mantenimiento" class="btn-primary" @onclick="SaveMaintenance">




@code{
    bool BandExistDevice { get; set; }
    string aux = "";
    MaintenanceEntity oMaintenance = new MaintenanceEntity();
    List<DeviceEntity> Devices = new List<DeviceEntity>();
    protected override async Task OnInitializedAsync()
    {
        Devices = B_Device.ListOfDevices();
        Devices= Devices.OrderBy(D => D.ClientId).ToList();
    }

    private void SaveMaintenance()
    {
        oMaintenance.MaintenanceId = Guid.NewGuid().ToString();
        B_Maintenance.Create(oMaintenance);
        B_Maintenance.UpdateDevice(oMaintenance.DeviceId);
        Nav.NavigateTo($"maintenance/view/{oMaintenance.MaintenanceId}");
    }


}