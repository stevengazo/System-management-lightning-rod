@using Entities;
@using Business;
@inject NavigationManager Nav;



<EditForm Model="oMaintenance">
    <div class="form-group">
        <label class="h3"> Referencia: @oMaintenance.MaintenanceId</label>
    </div>
    <div class="form-group">
        <label>Fecha de Mantenimiento</label>
        <InputDate class="form-control" @bind-Value="oMaintenance.MaintenanceDate"></InputDate>
    </div>
    <div class="form-group">
        <label> Estado del dispositivo</label>
        <InputTextArea class="form-control" @bind-Value="oMaintenance.StatusOfDevice"></InputTextArea>
    </div>
    <div class="form-group">
        <label> Resistencia de la malla</label>
        <InputNumber class="form-control" @bind-Value="oMaintenance.SpatOhms"></InputNumber>
    </div>
    <div class="form-group">
        <label>Resistencia de las Semiesferas del Dispositivo</label>
        <InputNumber class="form-control" @bind-Value="oMaintenance.DeviceOhms"></InputNumber>
    </div>
    <div class="form-group">
        <label>Transferencia de Cargas</label>
        <InputNumber class="form-control" @bind-Value="oMaintenance.Ampers"></InputNumber>
    </div>
    <div class="form-group">
        <label>Numero de Informe</label>
        <InputText class="form-control" @bind-Value="oMaintenance.ReportId"></InputText>
    </div>
    <div class="form-group">
        <label>Recomendaciones</label>
        <InputTextArea class="form-control" @bind-Value="oMaintenance.Recomendations"></InputTextArea>
    </div>
    <div class="form-group">
        <label>Numero de Equipo</label>
        <InputSelect class="form-control" @bind-Value="oMaintenance.DeviceId">
            @if (oDevices.Count != 0)
            {
                <option value=""> Seleccione un equipo...</option>
                @foreach (var Device in oDevices)
                {
                    <option value="@Device.DeviceId">@Device.DeviceId - @Device.Client.Name </option>
                }
            }
            else
            {
                <option value="">No hay dispositivos activos</option>
            }
        </InputSelect>
    </div>
    <div class="form-group">
        <label>Tecnico encargado</label>
        <InputSelect class="form-control" @bind-Value="oMaintenance.TechnicianId">
            @if (technicians.Count != 0)
            {
                <option value="0"> Seleccione un Tecnico...</option>
                @foreach (TechnicianEntity technician in technicians)
                {
                    <option value="@technician.TechnicianId">@technician.TechnicianName </option>
                }
            }
            else
            {
                <option value="0">No hay tecnicos disponibles</option>
            }
        </InputSelect>
    </div>

</EditForm>
<input type="button" value="ActualizarMantenimiento" class="btn-primary" @onclick="UpdateMaintenance" />

@code{
    [Parameter]
    public string id { get; set; }


    List<TechnicianEntity> technicians = new List<TechnicianEntity>();
    List<DeviceEntity> oDevices;

    MaintenanceEntity oMaintenance = new MaintenanceEntity();
    List<DeviceEntity> Devices = new List<DeviceEntity>();
    protected override async Task OnInitializedAsync()
    {
        Devices = B_Device.ListOfDevices();
        oMaintenance = B_Maintenance.MaintenanceById(id);

        oDevices = B_Device.GetListofDevicesActive();
        technicians = B_Technician.GetListOftechnicians();
    }

    private void UpdateMaintenance()
    {


        var tmpTechnician = technicians.Find(T => T.TechnicianId == oMaintenance.TechnicianId);
        oMaintenance.Technician = tmpTechnician;
        var tmpDevice = oDevices.Find(D => D.DeviceId == oMaintenance.DeviceId);
        oMaintenance.Device = tmpDevice;

        B_Maintenance.Update(oMaintenance);
        Nav.NavigateTo("maintenance/list");
    }
}