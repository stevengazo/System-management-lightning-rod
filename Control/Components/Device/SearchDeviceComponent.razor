@using Entities;
@using Business;



<div>
    <div>
        <label>Serie</label>
        <input type="text" @bind="DeviceIdToSearch" class=" form-control-sm" />
        <label>Alias</label>
        <input type="text" @bind="AliasToSearch" class="form-control-sm" />
        <label>Año</label>
        <select class="form-control-sm" @bind="YearToSearch">
            <option value="">Seleccione un año</option>
            @foreach (var item in Years)
            {
                <option value="@item">@item</option>
            }
        </select>
        <label>Pais</label>
        <select class="form-control-sm" @bind="CountryToSearch">
            <option value="">Seleccione un pais</option>
            @foreach (var item in Countries)
            {
                <option value="@item">@item</option>
            }
        </select>
    </div>
    <div>
        <input class="btn-outline-dark" type="button" value="Buscar"  @onclick="Search" />
        <input class="btn-outline-dark" type="button" value="Limpiar" @onclick="Clean" />
        <input class="btn-outline-dark" type="button" value="Exportar"  />
    </div>
    <p class="text-center" style="color:red"> @ErrorMessage</p>
</div>

<hr />

<div>
    <table class="table table-hover table-striped table-responsive-sm ">
        <thead>
            <tr>
                <th> Numero de Serie</th>
                <th> Alias</th>
                <th> Fecha de Instalación</th>
                <th> Vendedor</th>
                <th> Cliente</th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var obj in Devices)
            {
            <tr>
                <td> @obj.DeviceId</td>
                <td> @obj.Alias</td>
                <td> @obj.InstallationDate.Date.ToShortDateString()</td>
                <td> @obj.SaleMan.Name</td>
                <td> @obj.Client.Name</td>
                <td> <a href="device/view/@obj.DeviceId"> Ver </a></td>
                <td> <a href="device/update/@obj.DeviceId"> Modificar</a></td>
                <td> <a style="color:red" href="device/delete/@obj.DeviceId"> Eliminar</a></td>
            </tr>
            }
        </tbody>
    </table>
</div>



@code {
    #region Public Parametres


    #endregion

    #region Internal Parametres
    /// Seach Variables

    public string CountryToSearch { get; set; }

    public int YearToSearch { get; set; }

    public string AliasToSearch { get; set; }

    public string DeviceIdToSearch { get; set; }

    public string ErrorMessage { get; set; }


    /// Internal Variables
    List<int> Years = B_Device.ListOfYears();
    List<string> Countries = B_Device.GetCountries();
    List<DeviceEntity> Devices = new List<DeviceEntity>();


    #endregion

    #region Methods

    private void Clean()
    {
        CountryToSearch = null;
        YearToSearch = 0;
        AliasToSearch = null;
        DeviceIdToSearch = null;

    }

    protected override async Task OnInitializedAsync()
    {

    }

    private void Search()
    {
        Devices = B_Device.GetDevicesByConsult(DeviceIdToSearch, AliasToSearch, YearToSearch,CountryToSearch);
        if (Devices.Count<= 0)
        {
            ErrorMessage = "No hay dispositivos que cumplan con los criterios de busqueda....";
        }
        else
        {
            ErrorMessage = null;
        }
    }

    #endregion
}
